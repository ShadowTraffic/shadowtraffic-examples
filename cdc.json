{
    "generators": [
        {
            "topic": "cdc-events",
            "vars": {
                "id": {
                    "_gen": "oneOf",
                    "choices": [
                        {
                            "_gen": "uuid"
                        },
                        {
                            "_gen": "lookup",
                            "topic": "cdc-events",
                            "path": [ "key" ]
                        }
                    ]
                }
            },
            "key": {
                "_gen": "var", "var": "id"
            },
            "value": {
                "transactionId": {
                    "_gen": "sequentialInteger",
                    "startingFrom": 0
                }
            },
            "stateMachine": {
                "_gen": "stateMachine",
                "for": {
                    "_gen": "var", "var": "id"
                },
                "initial": "insert",
                "transitions": {
                    "insert": {
                        "_gen": "weightedOneOf",
                        "choices": [
                            { "weight": 4, "value": "update" },
                            { "weight": 1, "value": "delete" }
                        ]
                    },
                    "update": {
                        "_gen": "oneOf",
                        "choices": [
                            "update", "delete"
                        ]
                    },
                    "delete": "insert"
                },
                "states": {
                    "insert": {
                        "value": {
                            "op": "c",
                            "payload": {
                                "before": null,
                                "after": {
                                    "id": { "_gen": "var", "var": "id" },
                                    "firstName": { "_gen": "string", "expr": "#{Name.first_name}" },
                                    "lastName": { "_gen": "string", "expr": "#{Name.last_name}" },
                                    "email": { "_gen": "string", "expr": "#{Internet.email_address}" }
                                }
                            }
                        }
                    },
                    "update": {
                        "value": {
                            "op": "u",
                            "payload": {
                                "before": { "_gen": "previousEvent", "path": [ "value", "payload", "after" ] },
                                "after": {
                                    "_gen": "merge",
                                    "objects": [
                                        { "_gen": "previousEvent", "path": [ "value", "payload", "after" ] },
                                        {
                                            "_gen": "someKeys",
                                            "object": {
                                                "firstName": { "_gen": "string", "expr": "#{Name.first_name}" },
                                                "lastName": { "_gen": "string", "expr": "#{Name.last_name}" },
                                                "email": { "_gen": "string", "expr": "#{Internet.email_address}" }
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    },
                    "delete": {
                        "value": {
                            "op": "d",
                            "payload": {
                                "before": { "_gen": "previousEvent", "path": [ "value", "payload", "after" ] },
                                "after": null
                            }
                        }

                    }
                }
            }
        }
    ],
    "connections": {
        "kafka": {
            "kind": "kafka",
            "producerConfigs": {
                "bootstrap.servers": "localhost:9092",
                "key.serializer": "io.shadowtraffic.kafka.serdes.JsonSerializer",
                "value.serializer": "io.shadowtraffic.kafka.serdes.JsonSerializer"
            }
        }
    }
}
